<%= render 'plannings/planning_payable_submenu' %>

<div id="resource-list-container" class="no-print">
  <div id="resource-container" class="scrollbar-custom">
	<div id="nurses-resource" class="no-print">
			<% today = Date.today %>
			<div class="nurses-resource-subsection-title resource-title-selectable"  data-url="<%= planning_payable_path(@planning, params: {m: today.month, y: today.year}) %>">全員</div>
			<% @grouped_nurses.each do |group, nurses| %>
				<div class="nurses-resource-subsection-title <%= 'resource-title-selectable colibri-clickable-link' if @teams_id_by_name.present? %>" data-url='<%= "/plannings/#{@planning.id}/teams/#{@teams_id_by_name[group]}/payable?m=#{today.month}&y=#{today.year}" if @teams_id_by_name.present? %>'><%= group %></div>
				<% nurses.each do |nurse| %>
					<p class="resource-list-element colibri-clickable-link" data-url="<%= planning_nurse_payable_path(@planning, nurse, params: {m: today.month, y: today.year}) %>"><%= nurse.try(:name) %></p>
				<% end %>
			<% end %>
	</div>
  </div>
</div>

<div id="payable-container">
  <div class='colibri-xs-title no-print' style='margin-left:5px'>給与統計</div>
	<div class='no-print'>
		<%= select_tag '年', options_for_select([['2018年', 2018],['2019年', 2019], ['2020年', 2020], ['2021年', 2021]], params[:y]), id: 'query_year' %>
		<%= select_tag '月', options_for_select([['1月', 1],['2月', 2], ['3月', 3], ['4月', 4], ['5月',5], ['6月',6], ['7月', 7], ['8月', 8], ['9月', 9], ['10月', 10], ['11月', 11], ['12月', 12]], params[:m]), id: 'query_month' %>
		<button id='payable-query-trigger' class='btn-colibri-light-gray btn btn-sm'><span class="glyphicon glyphicon-refresh" style="color:white;font-size:0.85em"></span></button>
	</div>
	<div class='colibri-dashboard-container-row no-print'>
		<div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>給与推移</span>
      </div>
      <div class='colibri-subcontainer-body'>
        <%= area_chart @provided_services_till_today.group_by_day(:service_date).sum(:total_wage), height: '95%', width: '500px', colors: ['#17a2b8'], suffix: '￥' %>
      </div>
		</div>
		<div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>サービスタイプ割合</span>
      </div>
			<div class='colibri-subcontainer-body' id='shintai-chart-container'>
				<div id="shintai-chart-div">
					<%= pie_chart [['身体', @provided_services_shintai], ['生活', @provided_services_seikatsu]], donut: true, height: '85%', suffix: '￥', legend: 'bottom', colors: ['#F9AE1B', '#3D9BF3','#EA5D25', '#F07891', '#F9AE1B', '#EDB3F5', '#71C47A', '#ED655F', '#A3D4F5', '#A587F6', '#BBE5CE',  '#8E8CBC', '#DF788C', '#F475E1', '#ABBDC5', '#EADA6E', '#6BBEA6', '#58F4C7', '#CE73A5', '#F4B2A3', '#53A042', '#C6CBF5', '#EE7513', '#E47774', '#8BAADC', '#57B2E6', '#ED8C4C'] %>
				</div>
				<div id='shintai-stats-div'>
					<table class='table table-bordered'>
						<thead>
							<tr>
								<th>身体</th>
								<th>生活</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><%= "#{@provided_services_shintai}￥" %></td>
								<td><%= "#{@provided_services_seikatsu}￥" %></td>
							</tr>
							<tr>
								<td><%= "#{(@provided_services_shintai.to_f / (@provided_services_seikatsu + @provided_services_shintai) * 100).round(1)}%" if (@provided_services_seikatsu + @provided_services_shintai) != 0 %></td>
								<td><%= "#{(@provided_services_seikatsu.to_f / (@provided_services_seikatsu + @provided_services_shintai) * 100).round(1)}%" if (@provided_services_seikatsu + @provided_services_shintai) != 0 %></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<div class='colibri-dashboard-container-row no-print'>
		<div class='colibri-dashboard-subcontainer'>
	    <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>従業員一覧</span>
      </div>
			<div class='colibri-subcontainer-body'>
				<%= bar_chart @provided_services_till_today.group('nurses.name').sum(:total_wage), suffix: '￥', plotOptions: {series: {pointWidth: 10}} %>
			</div>
		</div>
	</div>

	<div id='extended-daily-summary-title-container'>
    <div class='colibri-xs-title'>業務日報</div>
    <div class='small-side-margins'><%= text_field_tag 'query_date', "#{Date.today.strftime("%Y-%m-%d")}", {data: {url: dashboard_extended_daily_summary_path}} %></div>
    <div class='btn btn-sm btn-success text-white small-side-margins no-print' id='print-button'>印刷</div>
  </div>

  <div id='extended-daily-summary-container'>
    <%= render partial: 'extended_daily_summary', locals: {daily_appointments: @daily_appointments, weekly_appointments: @weekly_appointments, monthly_appointments: @monthly_appointments, daily_provided_services: @daily_provided_services, female_patients_ids: @female_patients_ids, male_patients_ids: @male_patients_ids} %>
  </div>

	<% if false %>

	<div class='colibri-dashboard-container-row'>
		<div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>データをダウンロードする</span>
      </div>
      <div class='colibri-subcontainer-body'>
				<div class="report-download-wrapper">
        	<%= link_to '全従業員サービス稼動数', planning_monthly_general_report_path(@planning, format: :xlsx), class: 'btn btn-success text-white' %>
				</div>
      </div>
		</div>

	</div>

	<% end %>
</div>