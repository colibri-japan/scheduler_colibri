<% if @recurring_appointment.errors.any?  %>
  alert("<%= j @recurring_appointment.errors.values.join('; ') %>");

<% else %>

  $('.modal').modal('hide');

  <% @appointments.each do |appointment| %>
    $('.calendar').fullCalendar('removeEvents' , '<%= "appointment_#{appointment.id}" %>');
    $('.nurse_calendar').fullCalendar('removeEvents' , '<%= "appointment_#{appointment.id}" %>');
    $('.patient_calendar').fullCalendar('removeEvents' , '<%= "appointment_#{appointment.id}" %>');
    $('.master_calendar').fullCalendar('removeEvents' , '<%= "appointment_#{appointment.id}" %>');

    
    $('.calendar').fullCalendar(
      'renderEvent', 
      $.parseJSON("<%= j render(partial: 'appointments/appointment.json', locals: {appointment: appointment}).html_safe  %>"), 
      false
    );

    
    $('.patient_calendar').fullCalendar(
      'renderEvent', 
      $.parseJSON("<%= j render(partial: 'appointments/appointment.json', locals: {appointment: appointment}).html_safe  %>"), 
      false
    );

    $('.nurse_calendar').fullCalendar(
      'renderEvent', 
      $.parseJSON("<%= j render(partial: 'appointments/appointment.json', locals: {appointment: appointment}).html_safe  %>"), 
      false
    );

    $('.master_calendar').fullCalendar(
      'renderEvent', 
      $.parseJSON("<%= j render(partial: 'appointments/appointment.json', locals: {appointment: appointment}).html_safe  %>"), 
      false
    );
  <% end %>


  $('#planning-activities').prepend("<%= j render partial: 'activities/activity', locals: {activity: @activity} %>");

<% end %>
