<% if @recurring_appointment.errors.any?  %>
    alert("<%= j @recurring_appointment.errors[:base].join('、') + 'の従業員が重複してます。' %>")
<% else %>
    $('.modal').modal('hide');
    $('.modal-backdrop').remove();

    if (typeof calendar === 'undefined') {
      let calendar;
    }
    if ($('.calendar').length > 0) {
      calendar = $('.calendar');
    } else if ($('.patient_calendar').length > 0) {
      calendar = $('.patient_calendar');
    } else if ($('.nurse_calendar').length > 0) {
      calendar = $('.nurse_calendar');
    } else if ($('.master_calendar').length > 0) {
      calendar = $('.master_calendar');
    }

    calendar.fullCalendar('removeEvents', '<%= "recurring_#{@recurring_appointment.id}" %>' );
    if (window.nurseId == <%= @recurring_appointment.nurse_id %> || window.patientId == <%= @recurring_appointment.patient_id %> || window.generalPlanning == 'true') {
      calendar.fullCalendar(
        'renderEvents',
        $.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @recurring_appointment}).html_safe  %>"), 
        false
      );
    }
    <% if @new_recurring_appointment.present? %>
      if (window.nurseId == <%= @new_recurring_appointment.nurse_id %> || window.patientId == <%= @new_recurring_appointment.patient_id %> || window.generalPlanning == 'true') {
        calendar.fullCalendar(
          'renderEvents',
          $.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @new_recurring_appointment}).html_safe  %>"), 
          false
        )
      }
    <% end %>

<% end %>

