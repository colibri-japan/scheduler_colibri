<% salary_rule_id = salary_rule.new_record? ? 'new_salary_rule' : 'edit_salary_rule' %>
<%= form_with model: salary_rule, remote: true, id: salary_rule_id do |form| %>

  <div class='modal-body'>

    <div class="form-group">
      <%= form.label :title, "タイトル", class: "colibri-form-label-dark" %><span class='required-field'>*</span>
      <%= form.text_field :title, required: true, class: "form-control" %>
    </div>

  </div>

  <div class='blue-background-form'>
    <div class="modal-subsection-title-sm">従業員フィルタ</div>

    <div class="form-group">
      <%= form.check_box :target_all_nurses, checked: salary_rule.target_all_nurses && !@nurse.present?, id: 'all_nurses_selected_checkbox' %>
    </div>

    <% nurse_id_list = @nurse.present? ? @nurse.id : salary_rule.nurse_id_list %>

    <div class="form-group" id="form_nurse_id_list_group">
      <%= form.label :nurse_id_list, "選択する", class: "colibri-form-label-dark" %>
      <%= form.select :nurse_id_list, grouped_options_for_select(@nurses.group_full_timer_for_select, nurse_id_list), {}, multiple: true, id: 'target-nurse-ids' %>
    </div>

    <div class="form-group" id="target_nurse_by_filter_group">
      <%= form.label :target_nurse_by_filter, "稼動日数フィルタ", class: "colibri-form-label-dark" %>
      <%= form.select :target_nurse_by_filter, options_for_select([['稼動日数100~299', 0],['稼動日数300~499', 1], ['稼動日数500以上', 2]], salary_rule.target_nurse_by_filter), {include_blank: 'フィルタなし'}, {id: :nurse_target_filter} %>
    </div>
  </div>

  <div class='modal-body'>
    <div class="modal-subsection-title-sm">サービスフィルタ</div>
    <% if @nurse.present? %>
      <div class="form-group">
        <%= form.label :service_date_range_start, "期間", class: "colibri-form-label-dark" %><span class='required-field'>*</span><br/>
        <%= form.text_field :service_date_range_start, id: 'salary_rule_service_date_range_start' %> ~ 
        <%= form.text_field :service_date_range_end, id: 'salary_rule_service_date_range_end' %>
      </div>
    <% end %>

    <div class="form-group">
      <%= form.label :date_constraint, "日時条件", class: "colibri-form-label-dark" %>
      <%= form.select :date_constraint, options_for_select([['条件なし', 0], ['祝日',1], ['日曜',2]], salary_rule.date_constraint), id: 'all_nurses_selected_checkbox' %>
    </div>

    <div class="form-group">
      <%= form.label :target_all_services, "対象タイプ", class: "colibri-form-label-dark" %>
      <%= form.check_box :target_all_services, checked: salary_rule.target_all_services, id: 'all_services_selected_checkbox' %>
    </div>

    <div class="form-group" id="form_service_title_list_group" style="<%= 'display:none' if salary_rule.target_all_services %>">
      <%= form.label :service_title_list, "サービスタイプを選択する", class: "colibri-form-label-dark" %>
      <%= form.collection_select :service_title_list, @services, :title, :title, {}, multiple: true, id: 'target-service-titles' %>
    </div>

  </div>

  <div class='blue-background-form'>
    <div class="modal-subsection-title-sm">手当計算式</div>

    <div class="form-group">
      <%= form.select :operator, options_for_select([['+', 0], ['x', 1]], salary_rule.operator) %>
      <%= form.number_field :argument, {step: 0.01} %>
      <%= form.select :hour_based, options_for_select([['/時間', true], ['/回数', false]], salary_rule.hour_based) %>
    </div>
  </div>
    <% if @nurse.present? %>
      <%= form.hidden_field :one_time_salary_rule, value: true %>
    <% end %>

  <div class="modal-footer">
    <div class="actions">
      <% if salary_rule.new_record? %>
        <div class="btn btn-colibri-light" data-dismiss="modal">閉じる</div>
      <% else %>
        <%= link_to '削除する', salary_rule, method: :delete, remote: true, class: 'btn btn-secondary', data: {confirm: "手当の計算ルールは削除されますが、既に計算された手当は削除されません。"} %>
      <% end %>
      <% confirmation = salary_rule.new_record? ? nil : {confirm: '今月の手当には明日午前に反映されますが、前の月の手当には反映されません'} %>
      <%= form.submit 'セーブする', class: 'btn btn-info', data: confirmation %>
    </div>
  </div>

<% end %>