<%= javascript_tag do %>
	window.appointmentsURL = "<%= j planning_appointments_url(@planning, params: {nurse_id: @nurse.id}) %>";
	window.recurringAppointmentsURL = "<%= j planning_recurring_appointments_url(@planning) %>";
	window.corporationNursesURL = "<%= j corporation_nurses_url(@corporation, format: :json) %>";
	window.createRecurringAppointmentURL = "<%= j new_planning_recurring_appointment_url(@planning) %>";
	window.validRangeStart = "<%= j @start_valid %>";
	window.validRangeEnd = "<%= j @end_valid %>";
	window.defaultView = "<%= j @corporation.default_individual_view %>";
	window.nurseId = "<%= j @nurse.id.to_s %>";
	window.minTime = "<%= j current_user.corporation.business_start_hour %>";
	window.maxTime = "<%= j current_user.corporation.business_end_hour %>";
	window.holidays = "<%= j HolidayJp.between(Date.new(@planning.business_year, @planning.business_month, 1).beginning_of_day, Date.new(@planning.business_year, @planning.business_month, -1).end_of_day).to_json.html_safe %>"
<% end %>

<%= render 'plannings/planning_nurses_submenu' %>

<div id="resource-list-container" class="no-print">
	<div id="toggle-patients-nurses-wrapper">
		<input type="checkbox" id="toggle-patients-nurses" class="no-print">
	</div>
	<div id="resource-container" class="scrollbar-custom">
		<div id="patients-resource" class="hide-resource">
			<% @patients.each do |patient| %>
				<p class="resource-list-element" data-url="<%= planning_patient_path(@planning, patient) %>"><%= patient.try(:name) %></p>
			<% end %>
		</div>
		<div id="nurses-resource" class="no-print">
			<div class="nurses-resource-subsection-title">正社員</div>
			<% @full_timers.each do |nurse| %>
				<p class="resource-list-element  <%= 'resource-selected' if nurse.id == @nurse.id %>" data-url="<%= planning_nurse_path(@planning, nurse) %>"><%= nurse.try(:name) %></p>
			<% end %>
			<div class="nurses-resource-subsection-title">非正社員</div>
			<% @part_timers.each do |nurse| %>
				<p class="resource-list-element   <%= 'resource-selected' if nurse.id == @nurse.id %>" data-url="<%= planning_nurse_path(@planning, nurse) %>"><%= nurse.try(:name) %></p>
			<% end %>
		</div>
	</div>

</div>

<div id="detail-container">

	<div id="detail-planning-container">
		<div id="detail-planning-title">
			<div id="planning-nurse-information">
				<div class="planning-nurse-module-title">
					<span id="nurse-name-wrapper"><%= @nurse.try(:name) %></span>
					<button id="nurse-details-button" class="btn btn-sm btn-light">詳細</button>
				</div>
				<div id="address-phone-container">
					<% if @nurse.address.present? %>
						<span class="glyphicon glyphicon-home"></span><%= " #{@nurse.address}  " %>
					<% end %>
					<% if @nurse.phone_number.present? %>
						<span class="glyphicon glyphicon-phone"></span><%= " #{@nurse.phone_number}" %>
					<% end %>
				</div>
			</div>
			<div id="activity-show-button-container" class="no-print">
				<% if @nurse.phone_mail.present? %>
					<div class="btn btn-success text-white" id="new-email-reminder" data-reminder-url="<%= nurse_new_reminder_email_path(@nurse) %>"><span class="glyphicon glyphicon-envelope" style="color:white"></span>リマインダーを送る</div>
				<% end %>
				<div class="btn btn-success text-white" id="print-button"><span class="glyphicon glyphicon-print" style="color:white"></span>印刷</div>
				<span id="activity-show-button" class="btn btn-success"><span class="glyphicon glyphicon-time" style="color:white"></span>最新編集履歴</span>
				<span id="activity-hide-button" class="btn btn-secondary"><span class="glyphicon glyphicon-time" style="color:white"></span>最新編集履歴を閉じる</span>
			</div>
		</div>



		<div id="planning-container">
			<div class="nurse_calendar"></div>
			<div id="planning-activity-module" class="no-print">
				<p class="planning-activity-module-title">最新編集履歴</p>
				<div id="planning-activities">
					<% @activities.each do |activity| %>
						<%= render partial: 'activities/activity', locals: {activity: activity} %>
					<% end %>
				</div>
			</div>
		</div>

		<div id="resource-details-panel">

			<div id="resource-details-block">
				<h1 class="colibri-xs-title"><%= @nurse.name %>の詳細</h1>
				<table>
					<tr>
						<th class="details-table-head">メール</th>
						<td><%= @nurse.phone_mail %></td>
					</tr>
					<tr>
						<th class="details-table-head">電話</th>
						<td><%= @nurse.phone_number %></td>
					</tr>
					<tr>
						<th class="details-table-head">週所</th>
						<td><%= @nurse.address %></td>
					</tr>
					<tr>
						<th class="details-table-head">スキル</th>
						<td><%= @nurse.skill_list %></td>
					</tr>
					<tr>
						<th class="details-table-head">備考</th>
						<td><%= @nurse.description %></td>
					</tr>
				</table>
			</div>

			<div id="service-history-block">
				<div class='resource-details-block-title'>過去の利用者</div>
				<% @patients_with_services.limit(3).each_with_index do |patient, index| %>
					<div class="resource-history"><%= index + 1 %><%= " - #{patient.name}様：" %><%= from_seconds_to_hours_minutes(patient.sum_service_duration) %></div>
				<% end %>
				<% if @patients_with_services.all[2..-1].present? %>
					<div class="resource-history">
						<button class='btn btn-sm btn-light' id="see-more-resource-history-button">もっと見る</button>
						<div id="more-resource-history">
							<%= @patients_with_services.all[2..-1].map{|patient| patient.name }.join(', ') %>
						</div>
					</div>
				<% end %>
			</div>

			<div id="service-balance-block">
				<div class='resource-details-block-title'>身体VS生活</div>
				<div id="chart-and-details-container">
					<div id="chart-wrapper">
						<%= pie_chart [['身体', @provided_services_shintai], ['生活', @provided_services_seikatsu]], donut: true, width: '100px', height: '100px', legend: false, colors: ['#ffc107', '#FF2E07'] %>
					</div>
					<div id="service-balance-details">
						<div class="service-balance-line">身体：<span class="detail-important-information"><%= from_seconds_to_hours_minutes(@provided_services_shintai) %></span></div>
						<div class="service-balance-line">生活：<span class="detail-important-information"><%= from_seconds_to_hours_minutes(@provided_services_seikatsu) %> </span></div>
					</div>
				</div>

			</div>

			<div id="resource-action-block">
				<%= link_to 'エディット', edit_nurse_path(@nurse), remote: true, class: 'btn btn-info btn-block' %>
			</div>
		</div>

		<div id="recurring-appointment-details-container" class="print">
			<div class="planning-activity-module-title">サービスの詳細</div>
			<div id="appointment-comments"></div>
		</div>

	</div>
</div>




<div id="print-options-confirm" title="印刷にコメントを表示する">
	<p>印刷するページにサービスのコメントを表示しますか？</p>
</div>

<div id="drag-drop-confirm" title="サービス編集確認">
	<p>下記の編集がセーブされます：</p>
	<div id="drag-drop-content"></div>
</div>




