<% if @appointment.errors.any? %>
  alert("<%= j @appointment.errors.values.join('; ') %>");
<% else %>
  if (typeof pathname === 'undefined') {
    let pathname
  }
  pathname = window.location.pathname;

  if (pathname.includes('payable')) {
    location.reload()
  } else {
    if (typeof calendar === 'undefined') {
      let calendar;
    }
    if (typeof toggleEditRender === 'undefined') {
      let toggleEditRender;
    }

    if ($('.calendar').length > 0) {
      calendar = $('.calendar');
      toggleEditRender = true;
    } else if ($('.patient_calendar').length > 0) {
      calendar = $('.patient_calendar');
      toggleEditRender = '<%= @appointment.patient_id %>' == window.patientId 
    } else if ($('.nurse_calendar').length > 0) {
      calendar = $('.nurse_calendar');
      toggleEditRender = '<%= @appointment.nurse_id %>' == window.nurseId
    } else if ($('.master_calendar').length > 0) {
      calendar = $('.master_calendar');
      toggleEditRender = '<%= @appointment.patient_id %>' == window.patientId || '<%= @appointment.nurse_id %>' == window.nurseId
    }
    
    $('.modal').modal('hide');

    calendar.fullCalendar('removeEvents', '<%= "appointment_#{@appointment.id}" %>' );

    if (toggleEditRender) {
      calendar.fullCalendar(
        'renderEvent', 
        $.parseJSON("<%= j render(partial: 'appointments/appointment.json', locals: {appointment: @appointment}).html_safe  %>"), 
        false
      );
    }

  }


<% end %>