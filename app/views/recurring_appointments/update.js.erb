<% if @recurring_appointment.errors.any?  %>
    alert("<%= j @recurring_appointment.errors[:base].join('、') + 'の従業員が重複してます。' %>")
<% else %>
    $('.modal').modal('hide');
    $('.modal-backdrop').remove();

    if (typeof renderEvent === 'undefined') {
      let renderEvent
    }

    if (typeof renderNewEvent === 'undefined') {
      let renderNewEvent
    }
  
    renderEvent = (window.currentResourceType === 'team') || (window.currentResourceType === 'nurse' && ['all', '<%= @recurring_appointment.nurse_id %>'].includes(window.currentResourceId)) || (window.currentResourceType === 'patient' && ['all', '<%= @recurring_appointment.patient_id %>'].includes(window.currentResourceId)) 

    if (window.fullCalendar) {
      let eventToRemove = window.fullCalendar.getEventById('<%= "recurring_#{@recurring_appointment.id}" %>')
      eventToRemove.remove()

      if (renderEvent) {
        window.fullCalendar.addEvent($.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @recurring_appointment}).html_safe %>"))
      }
    }

    renderNewEvent = (window.currentResourceType === 'team') || (window.currentResourceType === 'nurse' && ['all', '<%= @new_recurring_appointment.nurse_id %>'].includes(window.currentResourceId)) || (window.currentResourceType === 'patient' && ['all', '<%= @new_recurring_appointment.patient_id %>'].includes(window.currentResourceId))

    <% if @new_recurring_appointment.present? %>
      if (renderNewEvent) {
        window.fullCalendar.addEvent($.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @new_recurring_appointment}).html_safe %>"))
      }
    <% end %>

<% end %>

