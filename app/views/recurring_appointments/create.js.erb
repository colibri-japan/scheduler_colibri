<% if @recurring_appointment.errors.any? %>
    alert("<%= j @recurring_appointment.errors[:base].join('、') + 'の従業員が重複してます。' %>")
<% else %>
  $('.modal').modal('hide');
  $('.modal-backdrop').remove();

  if (typeof renderEvent === 'undefined') {
    let renderEvent
  }
  
  renderEvent = (window.currentResourceType === 'team') || (!window.currentResourceType && window.defaultResourceType === 'team') || (window.currentResourceType === 'nurse' && ['all', '<%= @recurring_appointment.nurse_id %>'].includes(window.currentResourceId)) || (window.currentResourceType === 'patient' && ['all', '<%= @recurring_appointment.patient_id %>'].includes(window.currentResourceId) ) ||  (!window.currentResourceType && (window.defaultResourceType === 'nurse' && ['all', '<%= @recurring_appointment.nurse_id %>'].includes(window.defaultResourceId)) || (window.defaultResourceType === 'patient' && ['all', '<%= @recurring_appointment.patient_id %>'].includes(window.defaultResourceId)) )

  console.log(renderEvent) 

  if (window.fullCalendar && renderEvent) {
    console.log('rendering event')
    events = $.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @recurring_appointment}).html_safe %>")
    for (let event of events) {
      console.log(event)
      window.fullCalendar.addEvent(event)
    }
  }

  $('#remote_container').html('<%= j render "new_individual_appointments" %>');
  $('#new_individual_appointments').modal('show');
  selectSecondAppointmentCopyOption()
  submitAppointmentCopyOption()
<% end %>
