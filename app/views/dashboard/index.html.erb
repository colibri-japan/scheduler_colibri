<%= render partial: 'plannings/planning_left_menu', locals: {nurse: @main_nurse, resource_path: planning_nurse_path(@planning, @main_nurse), resource_master_path: planning_nurse_master_path(@planning, @main_nurse), view: 'home' } %>

<div id='colibri-dashboard-container'>

  <div class='colibri-dashboard-big-container no-print'>
    <div class='colibri-dashboard-container-column-large'>

      <div class='colibri-dashboard-subcontainer subcontainer-column-half-height'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'><%= @current_user_team.team_name if @current_user_team.present? %>調整中リスト（先２週間）</span>
        </div>
        <div class='colibri-subcontainer-body scrollbar-custom colibri-scrollbar-light'>
          <table class='table'>
            <thead>
              <tr>
                <th>提供日</th>
                <th>サービス</th>
                <th>利用者名</th>
                <th>従業員名</th>
                <th>稼働時間</th>
              </tr>
            </thead>
            <tbody>
              <% @edit_requested_appointments.each do |appointment| %>
              <tr>
                <td><%= appointment.starts_at.strftime("%-m月%-d日") %></td>
                <td><%= appointment.title %></td>
                <td><%= appointment.patient.try(:name) %></td>
                <td><%= appointment.nurse.try(:name) %></td>
                <td><%= from_seconds_to_hours_minutes(appointment.ends_at - appointment.starts_at) %></td>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <div class='colibri-dashboard-subcontainer subcontainer-column-half-height'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'>最新履歴</span><span class="unseen-activity-count"><%= "   ログアウト以降：#{@unseen_activity_count}" %></span>
        </div>
        <div class='colibri-subcontainer-body scrollbar-custom colibri-scrollbar-light' >
          <%= render partial: 'activities/activity', collection: @activities, cached: true %>
        </div>
      </div>

    </div>

    <div class='colibri-dashboard-container-column-narrow'>
      <div class='colibri-dashboard-subcontainer subcontainer-column-full-height'>
        <div class='colibri-subcontainer-header'>
          <div style='display:flex;justify-content:space-between;margin-bottom:3px' id='dashboard-posts-header-container'>
            <div id='dashboard-posts-header'>
              <% if @unread_count > 0 %>
                <span id='unread-count' style='font-weight:bold;margin-left:4px'><%= "未読#{@unread_count}件" %></span>
                </div>
                <%= link_to '既読にする', mark_all_posts_as_read_path(current_user), method: :patch, remote: true, id: 'mark-posts-as-read-button', class: 'btn btn-sm btn-success' %>
              <% else %>
                <span class='colibri-subcontainer-title'>掲示板</span>
                </div>
                <%= link_to '検索する', posts_path, class: 'btn btn-sm btn-info text-white' %>
              <% end %>
          </div>
        </div>
        <div class='colibri-subcontainer-body-with-footer scrollbar-custom colibri-scrollbar-light' id='posts-container'>
          <% @posts.to_a.reverse.each do |post| %>
            <%= render post %>
          <% end %>
        </div>
        <div class='colibri-subcontainer-footer'>
          <%= link_to '新規メッセージ', new_post_path, remote: true, class: 'btn btn-info text-white form-control btn-block' %>
        </div>
      </div>
    </div>

  </div>


  <div class='colibri-dashboard-container-row no-print'>
    <div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>コメント付きサービス（先２週間）</span>
      </div>
      <div class='colibri-subcontainer-body  scrollbar-custom colibri-scrollbar-light'>
        <table class='table'>
          <thead>
            <tr>
              <th style="width:20%">利用者</th>
              <th style="width:20%">従業員</th>
              <th style="width:20%">開始時間</th>
              <th style="width:40%">コメント</th>
            </tr>
          </thead>
          <tbody>
            <% @commented_appointments.each do |appointment| %>
            <tr>
              <td style="width:15%"><%= "#{appointment.patient.name }様"%></td>
              <td style="width:15%"><%= "#{appointment.nurse.name }"%></td>
              <td style="width:15%"><%= appointment.starts_at.strftime("%-m月%-d日") %></td>
              <td style="width:55%"><%= appointment.description %></td>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    
  </div>
 

</div>
