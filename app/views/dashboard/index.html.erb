<div id='dashboard-plannings-container'>
  <div id='new-planning-container'>
    <%= link_to '+新規スケジュール', new_planning_path, class: 'btn btn-info btn-sm text-white btn-margin-top' %>
  </div>
  <div id='dashboard-plannings-list'>
    <% @plannings.each do |planning| %>
      <div class="resource-list-element" data-url="<%= planning_path(planning) %>"><%= planning.title %></div>
    <% end %>
  </div>
</div>

<div id='colibri-dashboard-container'>
  <% if false %>
    <div id='colibri-dashboard-commands'>
      <%= link_to '日報をダウンロード', dashboard_index_path(format: :xlsx), class: 'btn btn-success btn-sm text-white' %>
    </div>
  <% end %>

  <div class='colibri-dashboard-big-container'>
    <div class='colibri-dashboard-container-column'>

      <div class='colibri-dashboard-subcontainer subcontainer-column-half-height'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'>最新履歴</span><span class="unseen-activity-count"><%= "   ログアウト以降：#{@unseen_activity_count}" %></span>
        </div>
        <div class='colibri-subcontainer-body'>
          <% @activities.each do |activity| %>
            <%= render partial: 'activities/activity', locals: {activity: activity} %>
          <% end %>
        </div>
      </div>


      <div class='colibri-dashboard-subcontainer subcontainer-column-half-height'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'>編集リスト（先２週間）</span>
        </div>
        <div class='colibri-subcontainer-body'>
          <table class='table'>
            <thead>
              <tr>
                <th>サービス</th>
                <th>利用者名</th>
                <th>提供日</th>
                <th>稼働時間</th>
              </tr>
            </thead>
            <tbody>
              <% @edit_requested_appointments.each do |appointment| %>
              <tr>
                <th><%= appointment.title %></th>
                <th><%= appointment.patient.name %></th>
                <th><%= appointment.starts_at.strftime("%-m月%-d日") %></th>
                <th><%= from_seconds_to_hours_minutes(appointment.ends_at - appointment.starts_at) %></th>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>


    </div>

    <div class='colibri-dashboard-container-column'>
      <div class='colibri-dashboard-subcontainer subcontainer-column-full-height'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'>掲示板</span>
        </div>
        <div class='colibri-subcontainer-body-with-footer' id='posts-container'>
          <% @posts.each do |post| %>
            <%= render partial: 'posts/post', locals: {post: post} %>
          <% end %>
        </div>
        <div class='colibri-subcontainer-footer'>
          <%= link_to '新規メッセージ', new_post_path, remote: true, class: 'btn btn-info text-white form-control btn-block' %>
        </div>
      </div>
    </div>

  </div>


  <% if false %>
  <div class='colibri-dashboard-container-row'>

      <div class='colibri-dashboard-subcontainer'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'>給与推移</span>
        </div>
        <div class='colibri-subcontainer-body'>
          <%= area_chart @provided_service_data, height: '95%', width: '500px', colors: ['#17a2b8'], suffix: '￥' %>
        </div>
      </div>
      <div class='colibri-dashboard-subcontainer'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'>稼働時間推移</span>
        </div>
        <div class='colibri-subcontainer-body'>
          <%= area_chart @provided_service_duration_sums, height: '95%', width: '500px', colors: ['#17a2b8'] %>
        </div>
      </div>
  </div>
  <% end %>

  <% if false %>

  <div class='colibri-dashboard-container-row'>



    <div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>利用状況(今月)</span>
      </div>
        <div class='colibri-subcontainer-body'>
          <table class='table'>
            <thead>
              <tr>
                <th class="table-important-fields">サービス</th>
                <th class="table-important-fields">女</th>
                <th class="table-important-fields">男</th>
                <th class="table-important-fields">計</th>
              </tr>
            </thead>
            <tbody>
              <%  @monthly_appointments_grouped_by_title.each do |service_name, appointments| %>
                <tr>
                  <th><%= service_name %></th>
                  <th><%= appointments.select{|appointment| @female_patients_ids.include?(appointment.patient_id)}.count %></th>
                  <th><%= appointments.select{|appointment| @male_patients_ids.include?(appointment.patient_id)}.count %></th>
                  <th><%= appointments.count %></th>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
    </div>

  </div>

  <% end %>

  <div class='colibri-dashboard-container-row'>
    <div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>コメント付きサービス（先２週間）</span>
      </div>
      <div class='colibri-subcontainer-body'>
        <table class='table'>
          <thead>
            <tr>
              <th style="width:20%">利用者</th>
              <th style="width:20%">ヘルパー</th>
              <th style="width:20%">開始時間</th>
              <th style="width:40%">コメント</th>
            </tr>
          </thead>
          <tbody>
            <% @commented_appointments.each do |appointment| %>
            <tr>
              <th style="width:15%"><%= "#{appointment.patient.name }様"%></th>
              <th style="width:15%"><%= "#{appointment.nurse.name }"%></th>
              <th style="width:15%"><%= appointment.starts_at.strftime("%-m月%-d日") %></th>
              <th style="width:55%"><%= appointment.description %></th>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    
  </div>

  <div class='colibri-dashboard-container-row'>
    <div class='colibri-dashboard-subcontainer'>
        <div class='colibri-subcontainer-header'>
          <span class='colibri-subcontainer-title'>利用状況(本日)</span>
        </div>
          <div class='colibri-subcontainer-body'>
            <table class='table'>
              <thead>
                <tr>
                  <th class="table-important-fields">サービス</th>
                  <th class="table-important-fields">女</th>
                  <th class="table-important-fields">男</th>
                  <th class="table-important-fields">計</th>
                </tr>
              </thead>
              <tbody>
                <%  @appointments_grouped_by_title.each do |service_name, appointments| %>
                  <tr>
                    <th><%= service_name %></th>
                    <th><%= appointments.select{|appointment| @female_patients_ids.include?(appointment.patient_id)}.count %></th>
                    <th><%= appointments.select{|appointment| @male_patients_ids.include?(appointment.patient_id)}.count %></th>
                    <th><%= appointments.count %></th>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
    </div>

    <div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span>利用状況（今週）</span>
      </div>
      <div class="colibri-subcontainer-body">
        <table class="table">
          <thead>
            <tr>
              <th class="table-important-fields">サービス</th>
              <th class="table-important-fields">女</th>
              <th class="table-important-fields">男</th>
              <th class="table-important-fields">計</th>
            </tr>
          </thead>
          <tbody>
            <%  @weekly_appointments_grouped_by_title.each do |service_name, appointments| %>
              <tr>
                <th><%= service_name %></th>
                <th><%= appointments.select{|appointment| @female_patients_ids.include?(appointment.patient_id)}.count %></th>
                <th><%= appointments.select{|appointment| @male_patients_ids.include?(appointment.patient_id)}.count %></th>
                <th><%= appointments.count %></th>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class='colibri-dashboard-container-row-large'>

    <div class='colibri-dashboard-subcontainer'>
      <div class='colibri-subcontainer-header'>
        <span class='colibri-subcontainer-title'>本日のサービス</span>
      </div>
        <div class='colibri-subcontainer-body'>
          <table class='table'>
            <thead>
              <tr>
                <th class="table-important-fields">利用者名</th>
                <th class="table-important-fields">性別</th>
                <th class="table-important-fields">訪問時間</th>
                <th class="table-important-fields">ヘルパー</th>
                <th class="table-important-fields">サービスタイプ</th>
                <th class="table-important-fields">確認する</th>
              </tr>
            </thead>
            <tbody>
              <% @daily_provided_services.each do |nurse_id, provided_services_array| %>
                <% provided_services_array.each do |provided_service| %>
                  <tr>
                    <th><%= provided_service.patient.try(:name) %></th>
                    <th><%= patient_gender(provided_service.patient) %></th>
                    <th><%= "#{provided_service.appointment_start.strftime('%H:%M')} ~ #{provided_service.appointment_end.strftime('%H:%M')}" %></th>
                    <th><%= provided_service.nurse.try(:name) %></th>
                    <th><%= provided_service.title %></th>
                    <th class='verify-provided-service' id='provided-service-<%= provided_service.id %>'>
                      <% if provided_service.verified? %>
                        <div><span class='glyphicon glyphicon-ok'  style="color: #42B97C"></span></div>
                      <% else %>
                        <%= link_to '確認', verify_provided_service_path(provided_service), method: :patch, remote: :true, class: 'btn btn-success btn-small' if !provided_service.verified? %>
                      <% end %>
                    </th>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
        </div>
    </div>
  </div>

</div>
