<% if @recurring_appointment.errors.any?  %>
    alert("<%= j @recurring_appointment.errors[:base].join('、') + 'の従業員が重複してます。' %>")
<% else %>
    $('.modal').modal('hide');
    $('.modal-backdrop').remove();

    if (typeof renderEvent === 'undefined') {
      let renderEvent
    }

    if (typeof renderNewEvent === 'undefined') {
      let renderNewEvent
    }
  
    renderEvent = (window.currentResourceType === 'team') || (window.currentResourceType === 'nurse' && ['all', '<%= @recurring_appointment.nurse_id %>'].includes(window.currentResourceId)) || (window.currentResourceType === 'patient' && ['all', '<%= @recurring_appointment.patient_id %>'].includes(window.currentResourceId)) 
    renderNewEvent = (window.currentResourceType === 'team') || (window.currentResourceType === 'nurse' && ['all', '<%= @new_recurring_appointment.nurse_id %>'].includes(window.currentResourceId)) || (window.currentResourceType === 'patient' && ['all', '<%= @new_recurring_appointment.patient_id %>'].includes(window.currentResourceId))

    if (window.fullCalendar) {
      window.fullCalendar.batchRendering(function(){
        let events = window.fullCalendar.getEvents()
        for (let event of events) {
          if (event.id === '<%= j "recurring_#{@recurring_appointment.id}" %>') {
            event.remove()
          }
        }

        if (renderEvent) {
          let eventsToRender = $.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @recurring_appointment}).html_safe %>")
          for (let event of eventsToRender) {
            window.fullCalendar.addEvent(event)
          }
        }

        <% if @new_recurring_appointment.present? %>
          if (renderEvent) {
            let newEvents = $.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @new_recurring_appointment}).html_safe %>")

            for (let newEvent of newEvents) {
              window.fullCalendar.addEvent(newEvent)
            }
          }
        <% end %>

      })
    }



<% end %>

