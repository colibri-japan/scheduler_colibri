<% if @recurring_appointment.errors.any?  %>
  alert("<%= j @recurring_appointment.errors.values.join('; ') %>");
<% else %>
  $('.modal').modal('hide');

  let calendar;
  if ($('.calendar').length > 0) {
    calendar = $('.calendar');
  } else if ($('.patient_calendar').length > 0) {
    calendar = $('.patient_calendar');
  } else if ($('.nurse_calendar').length > 0) {
    calendar = $('.nurse_calendar');
  } else if ($('.master_calendar').length > 0) {
    calendar = $('.master_calendar');
  }

  <% if @recurring_appointment.master %>
    calendar.fullCalendar('removeEvents', '<%= "recurring_#{@recurring_appointment.id}" %>' );
    calendar.fullCalendar(
      'renderEvents',
      $.parseJSON("<%= j render(partial: 'recurring_appointments/recurring_appointment.json', locals: {recurring_appointment: @recurring_appointment}).html_safe  %>"), 
      false
    )
  <% else %>
    <% @appointments.each do |appointment| %>
      calendar.fullCalendar('removeEvents' , '<%= "appointment_#{appointment.id}" %>');
      
      calendar.fullCalendar(
        'renderEvent', 
        $.parseJSON("<%= j render(partial: 'appointments/appointment.json', locals: {appointment: appointment}).html_safe  %>"), 
        false
      );

    <% end %>
  <% end %>

<% end %>